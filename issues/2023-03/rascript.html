<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta content="width=device-width" name="viewport">
  <!-- <title>RAScript Tutorials</title> -->
  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>RAScript Tutorials | RANews</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="RAScript Tutorials" />
<meta name="author" content="Etron" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Tutorial #11 ‚Äì Rich Presence" />
<meta property="og:description" content="Tutorial #11 ‚Äì Rich Presence" />
<link rel="canonical" href="https://news.retroachievements.org/issues/2023-03/rascript.html" />
<meta property="og:url" content="https://news.retroachievements.org/issues/2023-03/rascript.html" />
<meta property="og:site_name" content="RANews" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-09-04T22:30:02+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="RAScript Tutorials" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"Etron"},"headline":"RAScript Tutorials","dateModified":"2025-09-04T22:30:02+00:00","datePublished":"2025-09-04T22:30:02+00:00","description":"Tutorial #11 ‚Äì Rich Presence","url":"https://news.retroachievements.org/issues/2023-03/rascript.html","mainEntityOfPage":{"@type":"WebPage","@id":"https://news.retroachievements.org/issues/2023-03/rascript.html"},"@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <link type="application/atom+xml" rel="alternate" href="https://news.retroachievements.org/feed.xml" title="RANews" />

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-177315439-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-177315439-1');
  </script>

  <link href="https://use.fontawesome.com/releases/v5.12.0/css/all.css" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap"
    rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Play:wght@700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/normalize.css">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/rafont.css">
  <link rel="shortcut icon" type="image/png"
    href="/img/retroachievements-logo-color-transparent-square.png" sizes="16x16 32x32 64x64">
</head>

<body>

  <div class="grid">
    <aside>
  <div class="sidebar-header">
    <a href="https://news.retroachievements.org">
      <img alt="" src="/img/ranews-small.png">
    </a>
  </div>
  <div class="article-list-container">
    <h2>2023-03</h2>

    <label for="article-list-toggle">&#9776;</label>
    <input id="article-list-toggle" type="checkbox"/>

    <ul class="article-list">
      
      
        
          

          
            <a href="/issues/2023-03/index.html">
              <li>Introduction</li>
            </a>
          
        
      
        
          

          
            <a href="/issues/2023-03/ra-awards.html">
              <li>RA Awards</li>
            </a>
          
        
      
        
          

          
            <a href="/issues/2023-03/set-of-the-month.html">
              <li>Set of the Month</li>
            </a>
          
        
      
        
          

          
            <a href="/issues/2023-03/this-month-in-retro.html">
              <li>This Month In Retro</li>
            </a>
          
        
      
        
          

          
            <a href="/issues/2023-03/monthly-stats.html">
              <li>Monthly Stats</li>
            </a>
          
        
      
        
          

          
            <a href="/issues/2023-03/milestones.html">
              <li>Milestones</li>
            </a>
          
        
      
        
          

          
            <a href="/issues/2023-03/current-events.html">
              <li>Current Events</li>
            </a>
          
        
      
        
          

          
            <a href="/issues/2023-03/community-news.html">
              <li>Community News</li>
            </a>
          
        
      
        
          

          
            <a href="/issues/2023-03/rapodcast.html">
              <li>RAPodcast</li>
            </a>
          
        
      
        
          

          
            <li class="active">RAScript Tutorials</li>
          
        
      
        
          

          
            <a href="/issues/2023-03/play-this-set.html">
              <li>Play This Set</li>
            </a>
          
        
      
        
          

          
            <a href="/issues/2023-03/wish-this-set.html">
              <li>Wish This Set</li>
            </a>
          
        
      
        
          

          
            <a href="/issues/2023-03/raguide.html">
              <li>RAGuide</li>
            </a>
          
        
      
        
          

          
            <a href="/issues/2023-03/radvantage.html">
              <li>RAdvantage</li>
            </a>
          
        
      
        
          

          
            <a href="/issues/2023-03/hot-cheevs.html">
              <li>HotCheevs Monthly</li>
            </a>
          
        
      
        
          

          
            <a href="/issues/2023-03/revisions-and-rescores.html">
              <li>Revisions and Rescores</li>
            </a>
          
        
      
        
          

          
            <a href="/issues/2023-03/art-updates.html">
              <li>Art Updates</li>
            </a>
          
        
      
        
          

          
            <a href="/issues/2023-03/top-players.html">
              <li>Top Players</li>
            </a>
          
        
      
        
          

          
            <a href="/issues/2023-03/ranniversaries.html">
              <li>RAnniversaries</li>
            </a>
          
        
      
        
          

          
            <a href="/issues/2023-03/top-masteries.html">
              <li>Top Masteries</li>
            </a>
          
        
      
        
          

          
            <a href="/issues/2023-03/most-wanted.html">
              <li>Most Wanted Games</li>
            </a>
          
        
      
        
          

          
            <a href="/issues/2023-03/set-creation-leaderboard.html">
              <li>Set Creation Leaderboard</li>
            </a>
          
        
      
        
          

          
            <a href="/issues/2023-03/spot-the-difference.html">
              <li>Spot The Difference</li>
            </a>
          
        
      
    </ul>
  </div>
  <div class="footer">
    <ul class="icons">
      <li>
        <a href="https://retroachievements.org/">
          <i class="icon icon-retroachievements"></i>
        </a>
      </li>
      <li>
        <a href="https://discord.gg/dq2E4hE">
          <i class="fab fa-discord"></i>
        </a>
      </li>
      <li>
        <a href="https://docs.retroachievements.org/">
          <i class="fa fa-book"></i>
        </a>
      </li>
      <li>
        <a href="https://github.com/RetroAchievements">
          <i class="fab fa-github"></i>
        </a>
      </li>
    </ul>
  </div>
</aside>

    <main>
      <header>
        <nav>
  
    <a href="/issues/2023-03/rapodcast.html" class="previous">
      &#x00ab
      
        RAPodcast
      
    </a>
  
  
    <a href="/issues/2023-03/play-this-set.html" class="next">
      
        Play This Set
      
      &#x00bb
    </a>
  
</nav>
      </header>
      <article>
        <header>
          
          <h1 id="top">RAScript Tutorials</h1>
          

          
          
          <div class="author">
            
              
              
              
              <img src="https://retroachievements.org/UserPic/Etron.png" alt="Etron">
            
            <span>By 
              
                
                
                <a href="https://retroachievements.org/user/Etron">Etron</a>
              
            </span>
          </div>
          
        </header>

        
        <div id="toc" class="toc-container ">
          <p class="toc-title">Contents</p>
          <ul>
  <li><a href="#tutorial-11--rich-presence">Tutorial #11 ‚Äì Rich Presence</a>
    <ul>
      <li><a href="#overview">Overview</a></li>
      <li><a href="#dictionaries">Dictionaries</a></li>
      <li><a href="#string-format">String Format</a></li>
      <li><a href="#value-expressions">Value Expressions</a></li>
      <li><a href="#lookup-expressions">Lookup Expressions</a></li>
      <li><a href="#macro-expressions">Macro Expressions</a></li>
    </ul>
  </li>
  <li><a href="#example-11a-super-mario-bros">Example #11A: Super Mario Bros.</a>
    <ul>
      <li><a href="#rich_presence_display">rich_presence_display()</a></li>
      <li><a href="#0-mode">{0} Mode</a></li>
      <li><a href="#1-paused">{1} Paused</a></li>
      <li><a href="#2-star-power">{2} Star Power</a></li>
      <li><a href="#3-power-up">{3} Power Up</a></li>
      <li><a href="#4-world">{4} World</a></li>
      <li><a href="#5-act">{5} Act</a></li>
      <li><a href="#6-swimming">{6} Swimming</a></li>
      <li><a href="#7-status">{7} Status</a></li>
      <li><a href="#8-lives">{8} Lives</a></li>
      <li><a href="#9-quest">{9} Quest</a>
        <ul>
          <li><a href="#script">Script</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#example-11b-muppet-racemania">Example #11B: Muppet RaceMania</a>
    <ul>
      <li><a href="#using-dictionaries-for-multiple-regions">Using Dictionaries for Multiple Regions</a></li>
      <li><a href="#rich_presence_conditional_display">rich_presence_conditional_display()</a></li>
      <li><a href="#0-racer">{0} Racer</a></li>
      <li><a href="#1-vehicle">{1} Vehicle</a></li>
      <li><a href="#2-track">{2} Track</a></li>
      <li><a href="#3-position">{3} Position</a>
        <ul>
          <li><a href="#script-1">Script</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#example-11c-pitfall-revisited">Example #11C: Pitfall! Revisited</a>
    <ul>
      <li><a href="#homework-11">Homework #11</a></li>
      <li><a href="#useful-memory">Useful Memory</a>
        <ul>
          <li><a href="#script-2">Script</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
        </div>
        

        <h1 id="tutorial-11--rich-presence">Tutorial #11 ‚Äì Rich Presence</h1>

<h2 id="overview">Overview</h2>

<p>This tutorial will show a few examples of how to create <strong>Rich Presence</strong> (RP) for various types of games.  <strong>Rich Presence</strong> is a public facing string of text that changes dynamically based on the player‚Äôs location in the game.  If a <strong>Rich Presence</strong> is not defined the emulator will default to the text ‚ÄúPlaying [Game name]‚Äù.  By defining a <strong>Rich Presence</strong> you give other players an idea of where they are in a game.  A bonus of using <strong>Rich Presence</strong> is it can expose cheaters, for example, if a player is a much higher level than they should be in the starting area.  For more information on the <strong>Rich Presence</strong> see the <a href="https://github.com/Jamiras/RATools/wiki/Rich-Presence-Functions">RATools Wiki</a>.</p>

<p align="center">
  <img src="https://github.com/Etron-RA/RetroAchievements/blob/main/Tutorials/11_Rich_Presence/RP_in_action.png?raw=true" />
</p>

<h2 id="dictionaries">Dictionaries</h2>

<p>A <strong>dictionary</strong> is a special type of data structure that organizes data by <strong>key</strong>/ <strong>value</strong> pairs.  The <strong>key</strong> is typically a number or a string which is converted into a <strong>hash</strong> that the computer uses to find where a <strong>value</strong> is in memory.  The <strong>hash</strong> function is very fast which makes <strong>dictionaries</strong> ideal for searching through large data sets.  For <strong>Rich Presence</strong>, <strong>dictionaries</strong> are used to convert in-game memory values to readable text.  For example, the first zone in Sonic the Hedgehog is Green Hill Zone Act 1.  By using a <strong>dictionary</strong> to define all the level names you could display ‚ÄúGreen Hill Zone Act 1‚Äù in the <strong>Rich Presence</strong> instead of the level value of 0x0000. See the <a href="https://github.com/Jamiras/RATools/wiki/Variables#dictionaries">RATools Wiki</a> for more information of how <strong>dictionaries</strong> works.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// To create a dictionary
dictionary = {
    key_1: value_1, 
    key_2: value_2,
    ‚Ä¶
    key_n: value_n
}
// To access a dictionary value
dictionary[key] = value
</code></pre></div></div>

<h2 id="string-format">String Format</h2>

<p>The <strong>String Format</strong> function is a common way to build a string with real memory values that are formatted for easy reading.  When defining a <strong>Format String</strong>, numbered curly brackets are used as placement markers to tell the computer where to insert a value.  The number in the curly brackets corresponds to the parameter number of format function starting at zero.  The format function itself is dynamic and can have as many parameters as necessary. For <strong>Rich Presence</strong> the <strong>String Format</strong> function is used to format the text to make the game memory readable. See the <a href="https://github.com/Jamiras/RATools/wiki/Built-in-Functions#formatformat_string-parameters">RATools Wiki</a> for more information of how the <strong>Format String</strong> function works.
<code class="language-plaintext highlighter-rouge">format(‚ÄúParameter #1: {0}, Parameter #2: {1}, ‚Ä¶, Parameter #n {n}, parameter_1, parameter_2, ‚Ä¶ parameter_n)</code></p>

<h2 id="value-expressions">Value Expressions</h2>

<p>The <strong>rich_presence_value</strong> function is used to convert a value in game memory into readable text.  The benefit of this function is that it supports multiple formats depending on the type of memory you are trying to display.  Often you will be showing the raw memory values however you can display memory as various time formats or as a floating point number. See the <a href="https://github.com/Jamiras/RATools/wiki/Rich-Presence-Functions#rich_presence_valuename-expression-format">RATools Wiki</a> for a complete list of the possible formats.</p>

<h2 id="lookup-expressions">Lookup Expressions</h2>

<p>The <strong>rich_presence_lookup</strong> function is used to look up the in game values from a  <strong>dictionary</strong>.  The in game memory is used as a <strong>key</strong> and it returns to matching <strong>value</strong>.  If the <strong>key</strong> is not in the <strong>dictionary</strong> then you can either define a fallback string, or an empty string is used if no fallback is defined.  See the <a href="https://github.com/Jamiras/RATools/wiki/Rich-Presence-Functions#rich_presence_lookupname-expression-dictionary-fallback">RATools Wiki</a> for more information on dictionary look ups.</p>

<h2 id="macro-expressions">Macro Expressions</h2>

<p>The <strong>rich_presence_macro</strong> function is similar to the <strong>rich_presence_value</strong> function except that the macros are built-in to the Libretro library.   The biggest advantage to using macros is when the game has ASCII or Unicode strings in the memory since the macros handle the text conversion internally. See the <a href="https://github.com/Jamiras/RATools/wiki/Rich-Presence-Functions#rich_presence_macromacro-expression">RATools Wiki</a> for a complete list of the possible macros.</p>

<h1 id="example-11a-super-mario-bros">Example #11A: Super Mario Bros.</h1>
<p>The game selected for this example is <a href="https://retroachievements.org/game/1446">Super Mario Bros. (NES)</a>.  The reason why this game was selected is  because it is a well-known game and it was used as an example in the <a href="https://docs.retroachievements.org/Rich-Presence/">RADocs</a>.</p>

<p align="center">
  <img src="https://github.com/Etron-RA/RetroAchievements/blob/main/Tutorials/11_Rich_Presence/SMB_Title.png?raw=true" />
</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Super Mario Bros.
// #ID = 1446

// $000E: Player's State:
function PlayerState() =&gt; byte(0x000e)

StatusLookup = {
    0: " [Loading]",
    1: " taking a vine warp",
    2: " entering a warp pipe",
    3: " entering a warp pipe",
    4: " üö©",
    5: " [Stage Complete]",
    6: " [Game Over]",
    7: " [Entering Area]",
    9: " growing",
    0xA: " shrinking",
    0xB: " üíÄ",
    0xC: " powering up",
}

// $0704: Can swim flag
function Swimming() =&gt; byte(0x000704)

SwimmingLookup = {
    1: " swimming",
}

// $0756: Set to 01 when large mario, 02 when fire-flower mario
function PowerUp() =&gt; byte(0x000756)

PowerupLookup = {
    0: "Small",
    1: "Super",
    2: "Fire",
}

// $075C: Act Number (0 based)
function Act() =&gt; byte(0x00075C)

// $075F: World (0 based)
function World() =&gt; byte(0x00075F)

// $075A: Mario Number of Lives, set to ff when game over
function Lives() =&gt; byte(0x00075A)

// $0770: Gameplay Mode, 00=demo/menu, 01=playing,
//        02=end of level
//        NB. Set to 02 and wait to advance a world
function GameplayMode() =&gt; byte(0x000770)

ModeLookup = {
    0: "[Demo] ",
    2: "[World Complete] ",
}

// $0776: Pause: 00=normal 81=pausing 01=paused 80=unpausing
function Pause() =&gt; byte(0x000776)

PausedLookup = {
    0x81: "‚ñå‚ñå ",
    0x80: "‚ñå‚ñå ",
    1: "‚ñå‚ñå ",
}

// $079f: Invulnerability Counter: starts at 23, counts to 0, 0=normal
function StarCounter() =&gt; byte(0x00079F)
function StarBitcount() =&gt; bit0(0x00079F) + bit1(0x00079F) + bit2(0x00079F) + bit3(0x00079F) + bit4(0x00079F) + bit5(0x00079F)

StarLookup = {
    5: "üåü ",
    4: "üåü ",
    3: "üåü ",
    2: "üåü ",
    1: "üåü ",
}

// $07FC: Second Quest enabled = 01
function SecondQuest() =&gt; byte(0x0007FC)

QuestLookup = {
    0x0: "1st",
    0x1: "2nd",
}

// Example #11A - Rich Presence for Super Mario Bros.
rich_presence_display("{0}{1}{2}{3} Mario in {4}-{5}{6}{7}, üö∂:{8}, {9} Quest",
    rich_presence_lookup("Mode", GameplayMode(), ModeLookup),
    rich_presence_lookup("Paused", Pause(), PausedLookup),
    rich_presence_lookup("Star", StarBitcount(), StarLookup),
    rich_presence_lookup("Powerup", PowerUp(), PowerupLookup),
    rich_presence_macro("Number", World() + 1),
    rich_presence_macro("Number", Act() + 1),
    rich_presence_lookup("Swimming", Swimming(), SwimmingLookup),
    rich_presence_lookup("Status", PlayerState(), StatusLookup),
    rich_presence_macro("Number", Lives() + 1),
    rich_presence_lookup("Quest", SecondQuest(), QuestLookup)
)
</code></pre></div></div>

<h2 id="rich_presence_display">rich_presence_display()</h2>

<p>The <code class="language-plaintext highlighter-rouge">rich_presence_display()</code> function is used to define the default <strong>Rich Presence</strong>. It is used in a similar way to the format() function where the first parameter is the format string and the rest of the parameters are the values inserted into the format string. See the <a href="https://github.com/Jamiras/RATools/wiki/Rich-Presence-Functions#rich_presence_displayformat_string-parameters">RATools Wiki</a> more information on <code class="language-plaintext highlighter-rouge">rich_presence_display()</code>.</p>

<h2 id="0-mode">{0} Mode</h2>

<p>The <code class="language-plaintext highlighter-rouge">ModeLookup</code> has two different values.  If the memory accessor <code class="language-plaintext highlighter-rouge">GameplayMode()</code> is 0 then it displays ‚Äú[Demo]‚Äù and if the value is 2 then it displays ‚Äú[World Complete]‚Äù.  Any other values will result in an empty string.</p>

<h2 id="1-paused">{1} Paused</h2>

<p>The <code class="language-plaintext highlighter-rouge">PausedLookup</code> has three values for the same display output. If the memory accessor <code class="language-plaintext highlighter-rouge">Pause()</code> is 0x1, 0x80, or 0x80 then it displays the pause emoji. Any other values will result in an empty string.</p>

<h2 id="2-star-power">{2} Star Power</h2>

<p>The <code class="language-plaintext highlighter-rouge">StarLookup</code> will display a star for any value between 1 to 5. The memory accessor <code class="language-plaintext highlighter-rouge">StarBitcount()</code> counts the first 5 bits of the byte and ignores the rest.  By counting the bits instead of using the raw values the <code class="language-plaintext highlighter-rouge">StarLookup</code> can be smaller since it only needs to have 5 possible values instead of 31.</p>

<h2 id="3-power-up">{3} Power Up</h2>

<p>The <code class="language-plaintext highlighter-rouge">PowerupLookup</code> has three values for each power state of  Mario. If the memory accessor <code class="language-plaintext highlighter-rouge">PowerUp()</code> is 0 then it displays ‚ÄúSmall‚Äù, if Mario collects a mushroom the value is 1 then it displays ‚ÄúSuper‚Äù, and when Mario collects a fire flower then it will display ‚ÄúFire‚Äù   Any other values will result in an empty string.</p>

<h2 id="4-world">{4} World</h2>

<p>The current world is zero based meaning that when Mario is in world 1 to memory accessor <code class="language-plaintext highlighter-rouge">World()</code> will be 0.  To display correctly we add 1 to the value of <code class="language-plaintext highlighter-rouge">World()</code>.</p>

<h2 id="5-act">{5} Act</h2>

<p>Similar to the world, the current act is also zero based meaning that when Mario is in act 1 to memory accessor <code class="language-plaintext highlighter-rouge">Act()</code> will be 0.  We use the same technique to display correctly by adding 1 to the value of <code class="language-plaintext highlighter-rouge">Act()</code>.</p>

<h2 id="6-swimming">{6} Swimming</h2>

<p>The <code class="language-plaintext highlighter-rouge">SwimmingLookup</code> only has one value defined.  If the memory accessor <code class="language-plaintext highlighter-rouge">Swimming ()</code> is 1 then it displays ‚Äúswimming‚Äù otherwise an empty string will be displayed.</p>

<h2 id="7-status">{7} Status</h2>

<p>The <code class="language-plaintext highlighter-rouge">StatusLookup</code> has 12 different definitions for the <code class="language-plaintext highlighter-rouge">PlayerState()</code>memory accessor.  This memory is used for both the game state and the current state of Mario.  The state information is more useful for achievement code than <strong>Rich Presence</strong> however, it gives some additional context to what the player is currently doing.</p>

<h2 id="8-lives">{8} Lives</h2>

<p>Like both the world and act, the current number of lives Mario has left is zero based meaning when Mario has 4 lives to memory accessor <code class="language-plaintext highlighter-rouge">Lives()</code> will be 3.  We use the same technique as the world and act to display the lives correctly by adding 1 to the value of <code class="language-plaintext highlighter-rouge">Lives()</code>.</p>

<h2 id="9-quest">{9} Quest</h2>

<p>The <code class="language-plaintext highlighter-rouge">QuestLookup</code> has two values defined for the current loop of the game. Super Mario Bros. is a game that has a second harder loop to play when you beat the final boss, Bowser, for the first time. If the memory accessor <code class="language-plaintext highlighter-rouge">SecondQuest()</code> is 0 then it displays ‚Äú1st‚Äùand if the value is 1 then it displays ‚Äú2nd‚Äù.  Any other values will result in an empty string.</p>

<h3 id="script">Script</h3>

<p>Script: <a href="https://github.com/Etron-RA/RetroAchievements/blob/main/Tutorials/11_Rich_Presence/Example_11A.rascript">Example #11A script</a></p>

<h1 id="example-11b-muppet-racemania">Example #11B: Muppet RaceMania</h1>

<p>The game <a href="https://retroachievements.org/game/13910">Muppet RaceMania</a> was selected for this example because it has multiple regions linked to it. Each region has different memory locations so both the Rich Presence and Achievements need to have separate logic for each region supported.  Fortunately, RATools can help manage the memory differences and make equivalent logic for each region.</p>

<p align="center">
  <img src="https://github.com/Etron-RA/RetroAchievements/blob/main/Tutorials/11_Rich_Presence/Muppets_Title.png?raw=true" />
</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Muppet RaceMania
// #ID = 13910

// Give each language an unique value
EU = 0
FR = 1
DE = 2
IT = 3
ES = 4
US = 5

// Array of each supported language
Languages = [EU, FR, DE, IT, ES, US]

// $00b8b7: [ASCII] CD-ROM Name
//          SCES_020.01;1 = EU
//          SCES_024.83;1 = FR
//          SCES_024.84;1 = DE
//          SCES_024.85;1 = IT
//          SCES_024.86;1 = ES
//          SLUS_012.37;1 = US
function CDROM() =&gt; 0xb8b7

// "SCES_020.01;1" = EU Disc
EU_Disc = [0x53,0x43,0x45,0x53,0x5F,0x30,0x32,0x30,0x2E,0x30,0x38,0x3B,0x31]

// "SCES_024.83;1" = FR Disc
FR_Disc = [0x53,0x43,0x45,0x53,0x5F,0x30,0x32,0x34,0x2E,0x38,0x33,0x3B,0x31]

// "SCES_024.84;1" = DE Disc
DE_Disc = [0x53,0x43,0x45,0x53,0x5F,0x30,0x32,0x34,0x2E,0x38,0x34,0x3B,0x31]

// "SCES_024.85;1" = IT Disc
IT_Disc = [0x53,0x43,0x45,0x53,0x5F,0x30,0x32,0x34,0x2E,0x38,0x35,0x3B,0x31]

// "SCES_024.86;1" = ES Disc
ES_Disc = [0x53,0x43,0x45,0x53,0x5F,0x30,0x32,0x34,0x2E,0x38,0x36,0x3B,0x31]

// "SLUS_012.37;1" = US Disc
US_Disc = [0x53,0x4C,0x55,0x53,0x5F,0x30,0x31,0x32,0x2E,0x33,0x37,0x3B,0x31]    

// Dictionary of the disc names
Discs = {
    EU: EU_Disc,
    FR: FR_Disc,
    DE: DE_Disc,
    IT: IT_Disc,
    ES: ES_Disc,
    US: US_Disc
}

// 0xb0f38: Player's character (EU)
// 0xb0328: Personnage du joueur (fr)
// 0xb01dc: Spielercharakter (De)
// 0xb01ec: Personaggio dei giocatore (It)
// 0xb038c: Personaje del jugador (Es)
// 0xb07a4: Player's character (US)
PlayerCharacter = {
    EU: byte(0xb0f38),
    FR: byte(0xb0328),
    DE: byte(0xb01dc),
    IT: byte(0xb01ec),
    ES: byte(0xb038c),
    US: byte(0xb07a4)
}

// Dictionary of all the racers
Racers = {
    0: "Kermit",
    1: "Miss Piggy",
    2: "Gonzo",
    3: "Fozzie",    
    4: "Rizzo",
    5: "Beaker",
    6: "Rowlf",
    7: "Animal",
    8: "Janice",
    9: "Dr. Teeth",
    10: "Floyd",
    11: "Zoot",
    12: "Bunsen",
    13: "Chef",
    14: "Sam",
    15: "Scooter",
    16: "Pepe",
    17: "Bobo",
    18: "Link",
    19: "Robin",
    20: "Johnny Fiamma",
    21: "Sal",
    22: "Bean Bunny",
    23: "Clifford",
    24: "Doozer"
}

// 0xb0f3c: Player's vehicle (EU)
// 0xb032c: V√©hicle du joueur (Fr)
// 0xb01e0: Spielerfahrzeug (De)
// 0xb01f0: Veicolo del giocatore (It)
// 0xb0390: Vehiculo del jugador (Es)
// 0xb07a8: Player's vehicle (US)
PlayerVehicle = {
    EU: byte(0xb0f3c),
    FR: byte(0xb032c),
    DE: byte(0xb01e0),
    IT: byte(0xb01f0),
    ES: byte(0xb0390),
    US: byte(0xb07a8)
}

// All the vehicles in the game
Vehicles = {
    0: "Racer",
    1: "Monster Truck",
    2: "Flying Saucer",
    3: "Bubbler",
    4: "Cheese",
    5: "Moon Buggy",
    6: "Bulldozer",
    7: "Dragster",
    8: "Love Bug",
    9: "Hotrod",
    10: "Spoetster",
    11: "Supercharger",
    12: "Hovercraft",
    13: "Hotdog",
    14: "Plane",
    15: "Dune Buggy",
    16: "Kart",
    17: "Water Buggy",
    18: "Spaceship",
    19: "Steamroller",
    20: "Speedster",
    21: "Flamer",
    22: "Snow Bike",
    23: "Trike",
    24: "Dumper"
}

// 0x0b1628: Current course set (EU)
// 0x0b0a18: Set de parcourses courante (Fr)
// 0x0b08d0: Aktuelle Set von Strecken (De)
// 0x0b08e0: Set di percorsi corrente (It)
// 0x0b0a80: Set de pistas actual (Es)
// 0x0b0e38: Current course set (US)
Set = {
    EU: byte(0x0b1628),
    FR: byte(0x0b0a18),
    DE: byte(0x0b08d0),
    IT: byte(0x0b08e0),
    ES: byte(0x0b0a80),
    US: byte(0x0b0e38)
}

// 0x0b1622: Current course (EU)
// 0x0b0a12: Parcours courante (Fr)
// 0x0b08ca: Aktuelle Strecke (De)
// 0x0b08da: Percorso corrente (It)
// 0x0b0a7a: Pista actual (Es)
// 0x0b0e32: Current course (US)
Course = {
    EU: byte(0x0b1622),
    FR: byte(0x0b0a12),
    DE: byte(0x0b08ca),
    IT: byte(0x0b08da),
    ES: byte(0x0b0a7a),
    US: byte(0x0b0e32)
}

// Dictionary of tracks are hashed by Set # * 16 + Course #
Tracks = {
    0x00: "Swamp",
    0x01: "Ghost Town",
    0x02: "Canyon",
    0x03: "Funfair",
    0x10: "Happiness Hotel",
    0x11: "Mallory Gallery",
    0x12: "Trafalgar Square",
    0x13: "Resturant",
    0x20: "Central Park",
    0x21: "New York City",
    0x22: "Theatre",
    0x23: "Diner",
    0x30: "Old London Town",
    0x31: "Graveyard",
    0x32: "Chamber",
    0x33: "Rooftops",
    0x40: "Dock",
    0x41: "Treasure Island",
    0x42: "Lagoon",
    0x43: "Mountain",
    0x50: "Secret Base",
    0x51: "Cape Doom",
    0x52: "Laboratory",
    0x53: "Muppet Labs",
    0x60: "Studio",
    0x61: "Arches",
    0x62: "Fraggle Rock",
    0x63: "Disco"
}

// 0x0c3e10: Player's race position (EU)
// 0x0c3158: Position du joueur (Fr)
// 0x0c3010: Platz im Rennen (De)
// 0x0c3020: Posizione del giocatore (It)
// 0x0c31c0: Posici√≥n del jugador (Es)
// 0x0c3572: Player's race position (US)
RacePosition = {
    EU: byte(0x0c3e10),
    FR: byte(0x0c3158),
    DE: byte(0x0c3010),
    IT: byte(0x0c3020),
    ES: byte(0x0c31c0),
    US: byte(0x0c3572)
}

// Dictionary of the place names for each position
Place = {
    1: "1st",
    2: "2nd",
    3: "3rd",
    4: "4th",
    5: "5th",
    6: "6th",
    7: "7th",
    8: "8th",
    9: "9th",
    10: "10th",
    11: "11th",
    12: "12th"
}

// Check if the string hex values equal the hex values at the passed address
function StringCompare(address, string)
{
    strArray = []
    for hexValue in string
    {
        array_push(strArray, byte(address) == hexValue)
        address = address + 1
    }
    return all_of(strArray, a =&gt; a)
}

// Make 25 example achievements using that support multiple languages
for index in range(0,24)
{
    // Setup the title and description of 
    title = Racers[index] + " " + Vehicles[index]
    description = "Select the racer " + Racers[index] + " with the vehicle " + Vehicles[index]
    triggers = []
        
    for language in Languages
    {
        // Make a condition to check the current language disc region and racer/vehicle combo
        array_push(triggers,
            StringCompare(CDROM(), Discs[language]) &amp;&amp;
            PlayerCharacter[language] == index &amp;&amp;
            PlayerVehicle[language] == index
        )
    }
    achievement(title, description, 0, any_of(triggers, t =&gt; t))
}

// Example #11B - Rich Presence the supports mulitple regions
for language in Languages
{
    disc = Discs[language]    
    rich_presence_conditional_display(
        StringCompare(CDROM(), disc) &amp;&amp;
            Set[language] != 0xff &amp;&amp;
            Course[language] != 0xff &amp;&amp;
            RacePosition[language] &gt;= 1 &amp;&amp; 
            RacePosition[language] &lt;= 12, 
        "{0} is driving a {1} on the track {2} in {3} position!", 
        rich_presence_lookup("Racer", PlayerCharacter[language], Racers),
        rich_presence_lookup("Vehicle", PlayerVehicle[language], Vehicles),
        rich_presence_lookup("Track", Set[language] * 0x10 + Course[language], Tracks),
        rich_presence_lookup("Position", RacePosition[language], Place)
    )
}
rich_presence_display("The muppets are in the menu!")
</code></pre></div></div>

<h2 id="using-dictionaries-for-multiple-regions">Using Dictionaries for Multiple Regions</h2>

<p>Similar to the regional strings <a href=".. /10_Strings/Example_10A.md">Example #10A</a> from the last tutorial we will be using the disc name to detect the region.  Memory accessors are defined using dictionaries instead of functions so that they can be looped through programmatically.  For example, instead of defining the <code class="language-plaintext highlighter-rouge">PlayerCharacter()</code> we store the accessor using the language as the key.  To access the North American memory use the command <code class="language-plaintext highlighter-rouge">PlayerCharacter[US]</code>.  The rational for setting up the memory like this is that you can create alts using the same basic logic.  Note that each language is a unique value and the array <code class="language-plaintext highlighter-rouge">Languages</code> contains all of the supported language values.</p>

<p>Included in the above code is a silly example of how to create achievements using dictionaries.  The achievements are to check if the racer has selected a certain vehicle.  The dictionaries we defined for the rich presence is also used here to build the title and description. The logic for each alt is essentially the same except for the part that checks the disc name.  The nice thing about coding an achievement like this is only one alt is ever active at a time.</p>

<h2 id="rich_presence_conditional_display">rich_presence_conditional_display()</h2>

<p>In this example we used the command <a href="https://github.com/Jamiras/RATools/wiki/Rich-Presence-Functions#rich_presence_conditional_displaycondition-format_string-parameters">rich_presence_conditional_display</a> to control what message is displayed depending on the disc name.  Each message format is exactly the same and the code will fill in the correct memory address for the region.  Remember that order matters when using the conditional display and it will display the string for the first condition that is met even if later conditions would also be true.</p>

<h2 id="0-racer">{0} Racer</h2>

<p>The <code class="language-plaintext highlighter-rouge">Racers</code> lookup has all 25 possible racers defined.  The memory accessor <code class="language-plaintext highlighter-rouge">PlayerCharacter[]</code> has a one to one match for the values in the lookup.</p>

<h2 id="1-vehicle">{1} Vehicle</h2>

<p>The <code class="language-plaintext highlighter-rouge">Vehicles</code> lookup has all 25 possible vehicles defined.  Like the Racer, the memory accessor <code class="language-plaintext highlighter-rouge">PlayerVehicle[]</code> has a one to one match for the values in the lookup.</p>

<h2 id="2-track">{2} Track</h2>

<p>The <code class="language-plaintext highlighter-rouge">Tracks</code> lookup has all 24 possible tracks defined.  This value is a composite value of the <code class="language-plaintext highlighter-rouge">Set[]</code> and <code class="language-plaintext highlighter-rouge">Course[]</code> accessors. By combining these values together we  can define all of the tracks in one lookup.  Note that the value of <code class="language-plaintext highlighter-rouge">Set[]</code> is multiplied by 16 to ensure each track value is unique.  The multiplier 16 was chose since in hex the <code class="language-plaintext highlighter-rouge">Course[]</code> would be the lower four bits and <code class="language-plaintext highlighter-rouge">Set[]</code> would be the upper four bits. Other multipliers could be used so long as the possible combinations all yield unique results.</p>

<h2 id="3-position">{3} Position</h2>

<p>The <code class="language-plaintext highlighter-rouge">Place</code> lookup has all 12 possible race placements defined.  Like the Racer and Vehicle, the memory accessor <code class="language-plaintext highlighter-rouge">RacePosition[]</code> has a one to one match for the values in the lookup.  Cardinal values (1, 2, ‚Ä¶, 12) could be displayed directly however, a dictionary was chosen to display the ordinal values (1st, 2nd, ‚Ä¶, 12th) instead.</p>

<h3 id="script-1">Script</h3>

<p>Scripts: <a href="https://github.com/Etron-RA/RetroAchievements/blob/main/Tutorials/11_Rich_Presence/Example_11B.rascript">Example #11B script</a></p>

<h1 id="example-11c-pitfall-revisited">Example #11C: Pitfall! Revisited</h1>

<p>The game <a href="https://retroachievements.org/game/11191">Pitfall!</a> was selected for this homework example since most of the values require arithmicatic operations to display correctly.  Pitfall! was covered in <a href="../04_Arithmetic_Operations/readme.md">Tutorial #4 ‚Äì Arithmetic Operations</a> if you would like a refresher on the game.<br /></p>

<p align="center">
  <img src="https://github.com/Etron-RA/RetroAchievements/blob/main/Tutorials/11_Rich_Presence/Solution/Pitfall_Golden_Scorpion.png?raw=true" />
</p>

<h2 id="homework-11">Homework #11</h2>

<p>Create a Rich Presence for a Pitfall! using the format: <code class="language-plaintext highlighter-rouge">"‚è≥{0} | üí≥{1}/32 | üßëx{2} | üíØ{3}"</code>` <br />
Where {0} is time, {1} is treasures obtained, {2} is lives, and {3} is score.</p>

<h2 id="useful-memory">Useful Memory</h2>

<p>To complete the homework problem you‚Äôll need the memory addresses:<br />
0x0000 -&gt; [8-bit] Lives,  bit5=1st extra life,  bit7=2nd extra life <br />
0x001E -&gt; [8-bit] 00=game active <br /> 
0x0055 -&gt; [BCD] Score XX0000 <br />
0x0056 -&gt; [BCD] Score 00XX00 <br />
0x0057 -&gt; [BCD] Score 0000XX <br />
0x0058 -&gt; [BCD] Time XX:00 <br />
0x0059 -&gt; [BCD] Time 00:XX <br />
0x005A -&gt; [8-bit] Time (milliseconds) <br />
0x006D -&gt; [8-bit] Treasures flags 1-8 <br />
0x006E -&gt; [8-bit] Treasures flags 9-16 <br />
0x006F -&gt; [8-bit] Treasures flags 17-24 <br />
0x0070 -&gt; [8-bit] Treasures flags 25-32 <br /></p>

<h3 id="script-2">Script</h3>

<p>Solutions: <a href="https://github.com/Etron-RA/RetroAchievements/blob/main/Tutorials/11_Rich_Presence/Solution/readme.md">Tutorial #11 Solution</a></p>

<hr />

<p><a href="../2022-02/rascript.html#tutorial-0---getting-started">Tutorial #0 - Getting Started</a><br />
<a href="../2022-02/rascript.html#tutorial-1---memory-basics">Tutorial #1 - Memory Basics</a><br />
<a href="../2022-03/rascript.html#tutorial-2---add-hits">Tutorial #2 - Add Hits</a><br />
<a href="../2022-04/rascript.html#tutorial-3---bit-flags">Tutorial #3 - Bit Flags</a><br />
<a href="../2022-05/rascript.html#tutorial-4---arithmetic-operations">Tutorial #4 - Arithmetic Operations</a><br />
<a href="../2022-06/rascript.html#tutorial-5---pointers">Tutorial #5 - Pointers</a><br />
<a href="../2022-07/rascript.html#tutorial-6--ifelse">Tutorial #6 - If/Else</a><br />
<a href="../2022-08/rascript.html#tutorial-7--challenges-part-1">Tutorial #7 - Challenges Part 1</a><br />
<a href="../2022-09/rascript.html#tutorial-8--challenges-part-2">Tutorial #8 - Challenges Part 2</a> <br />
<a href="../2022-11/rascript.html#tutorial-9--trigger-and-measure-together">Tutorial #9 - Trigger and Measure Together</a> <br />
<a href="../2022-12/rascript.html#tutorial-10--strings">Tutorial #10 - Strings</a></p>

<p>All RAScript Tutorials can be found <a href="https://github.com/Etron-RA/RetroAchievements/tree/main/Tutorials">here</a>.</p>


      </article>
      <footer>
        <nav>
  
    <a href="/issues/2023-03/rapodcast.html" class="previous">
      &#x00ab
      
        RAPodcast
      
    </a>
  
  
    <a href="/issues/2023-03/play-this-set.html" class="next">
      
        Play This Set
      
      &#x00bb
    </a>
  
</nav>
      </footer>
    </main>
  </div>

</body>

</html>